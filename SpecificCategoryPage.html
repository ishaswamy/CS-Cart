<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Business Menu</title>
    <link rel="stylesheet" type="text/css" href="styles/customerhome_style.css">
</head>

<body>
    <iframe src="HeaderMenu.html" class="header-frame"></iframe>

    <h1>Menu</h1>
    <p>Select an item to customize</p>

    <div class="menu-container"></div>

    <script>
        async function fetchUser() {
            try {
                const response = await fetch("http://127.0.0.1:5000/account", {
                    method: "GET",
                    credentials: "include"
                });
                if (!response.ok) {
                    throw new Error(`HTTP error! Status: ${response.status}`);
                }
                const data = await response.json();
                console.log("Server Response:", data);
                return data.message.split(' ')[1];
            } catch (error) {
                console.error("Error fetching user:", error);
                alert("Failed to fetch user.");
            }
        }

        async function fetchMenu(username) {
            try {
                const urlParams = new URLSearchParams(window.location.search);
                const category = urlParams.get('category');
                console.log("Category selected: " + category);

                const response = await fetch(`http://127.0.0.1:5000/get-specific-items?username=${"akumar"}&category=${category}`);

                const data = await response.json();

                if (data.error) {
                    console.error("Error fetching menu:", data.error);
                    return;
                }

                const menuContainer = document.querySelector(".menu-container");
                menuContainer.innerHTML = ""; // Clear existing items

                data.menuItems.forEach(item => {
                    const itemDiv = document.createElement("div");
                    itemDiv.classList.add("menu-item");

                    const itemImage = document.createElement("img");
                    itemImage.src = item.imageUrl || "https://images.pexels.com/photos/1639565/pexels-photo-1639565.jpeg?cs=srgb&dl=pexels-valeriya-1639565.jpg&fm=jpg";
                    itemImage.alt = item.itemName;

                    const itemName = document.createElement("h3");
                    itemName.innerText = item.itemName;



                    itemDiv.appendChild(itemImage);
                    itemDiv.appendChild(itemName);


                    menuContainer.appendChild(itemDiv);
                });
            } catch (error) {
                console.error("Error fetching menu:", error);
            }
        }

        window.onload = async () => {
            const user = await fetchUser();
            if (user) {
                fetchMenu(user);
            } else {
                alert("Failed to fetch user.");
            }
        };
    </script>
</body>

</html>