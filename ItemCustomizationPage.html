<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Item Customization</title>
    
    <link rel="stylesheet" href="styles/item_customization_style.css">
    
</head>
<body>
    <iframe src="HeaderMenu.html" class="header-frame"></iframe>
    <div class="container">
        
        <div class="image-container">
            <img src="https://images.pexels.com/photos/1639565/pexels-photo-1639565.jpeg?cs=srgb&dl=pexels-valeriya-1639565.jpg&fm=jpg" alt="Product Image" style="width:100%;border-radius:5px;">
        </div>
        <div class="details-container">
            <h2>Customize Your Item</h2>
            <p><strong>Item Name:</strong> <span id="itemName">Hamburger</span></p>
            <p><strong>Base Price:</strong> $<span id="basePrice">8.00</span></p>
            
            <h3>Ingredients:</h3>
            <button class="ingredient-btn" onclick="toggleIngredient(this)" data-name="Bun">Bun</button>
            <button class="ingredient-btn" onclick="toggleIngredient(this)" data-name="Lettuce">Lettuce</button>
            <button class="ingredient-btn" onclick="toggleIngredient(this)" data-name="Cheese">Cheese</button>
            <button class="ingredient-btn" onclick="toggleIngredient(this)" data-name="Tomato">Tomato</button>
            
            <h3>Extras:</h3>
            <button class="extra-btn" onclick="toggleExtra(this, 1)" data-name="Extra Cheese" data-price="1.00">Extra Cheese (+$1.00)</button>
            <button class="extra-btn" onclick="toggleExtra(this, 2)" data-name="Bacon" data-price="2.00">Bacon (+$2.00)</button>
            
            <br><label for="quantity">Quantity:</label>
            <input type="number" id="quantity" value="1" min="1" onchange="updatePrice()">
            
            <p class="total-price">Total Price: $8.00</p>
            <button onclick="addToCart()">Add to Cart</button>
        </div>
    </div>

    <script>
        function toggleIngredient(button) {
            button.classList.toggle("removed");
        }

        function toggleExtra(button, price) {
            button.classList.toggle("selected");
            updatePrice();
        }

        function updatePrice() {
            let basePrice = parseFloat(document.getElementById("basePrice").innerText);
            let extraCost = 0;
            
            document.querySelectorAll(".extra-btn.selected").forEach(btn => {
                extraCost += parseFloat(btn.dataset.price);
            });
            
            let quantity = parseInt(document.getElementById("quantity").value);
            let totalPrice = (basePrice + extraCost) * quantity;
            
            document.querySelector(".total-price").innerText = "Total Price: $" + totalPrice.toFixed(2);
        }

        async function addToCart() {
            let username = "testTemporaryUser"; //temporary hardcoded value
            let itemName = document.getElementById("itemName").innerText;
            let basePrice = parseFloat(document.getElementById("basePrice").innerText);
            let quantity = parseInt(document.getElementById("quantity").value);
            
            let freeItems = {};
            document.querySelectorAll(".ingredient-btn").forEach(btn => {
                freeItems[btn.dataset.name] = !btn.classList.contains("removed");
            });

            let paidItems = [];
            document.querySelectorAll(".extra-btn.selected").forEach(btn => {
                paidItems.push({
                    name: btn.dataset.name,
                    price: parseFloat(btn.dataset.price),
                    selected: true
                });
            });

            let product = {
                "itemName": itemName,
                "category": "Burger",
                "price": basePrice,
                "quantity": quantity,
                "freeItems": freeItems,
                "paidItems": paidItems,
                "businessID": "Protected"
            };

            let response = await fetch("http://localhost:5000/add-to-cart", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json"
                },
                body: JSON.stringify({ product, username })
            });

            let result = await response.json();
            alert(result.message);
        }
    </script>
</body>
</html>
