<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Customize Menu Item</title>
    <link rel="stylesheet" type="text/css" href="styles/business_item_customization.css">
</head>

<body>
    <iframe src="HeaderMenu.html" class="header-frame"></iframe>

    <div class="container">
        <h1><input type="text" id="item-name" value="New Item"></h1>
        <p>Category: <input type="text" id="category" placeholder="Category"></p>
        <p>Price: $<input type="number" id="item-price" step="0.01"></p>
        <p>Item Image URL: <input type="url" id="item-image-url" placeholder="Image url"></p>

        <div class="item-section">
            <h2>Included Items</h2>
            <input type="text" id="new-free-item-name" placeholder="Item name">
            <button onclick="addFreeItem()">Add</button>
            <div id="free-items"></div>
        </div>

        <div class="item-section">
            <h2>Free Toggle Items</h2>
            <input type="text" id="new-free-toggle-name" placeholder="Item name">
            <button onclick="addFreeToggleItem()">Add</button>
            <div id="free-toggle-items"></div>
        </div>

        <div class="item-section">
            <h2>Paid Items</h2>
            <input type="text" id="new-paid-item-name" placeholder="Item name">
            <input type="number" id="new-paid-item-price" placeholder="Price" step="0.01">
            <button onclick="addPaidItem()">Add</button>
            <div id="paid-items"></div>
        </div>

        <div class="item-section">
            <h2>Paid Toggle Extras</h2>
            <input type="text" id="new-paid-toggle-name" placeholder="Item name">
            <input type="number" id="new-paid-toggle-price" placeholder="Price" step="0.01">
            <button onclick="addPaidToggleItem()">Add</button>
            <div id="paid-toggle-items"></div>
        </div>

        <button onclick="addItem()">Add Item</button>
    </div>

    <script>
        // Add an Included Item with a delete button
        function addFreeItem() {
            const container = document.getElementById("free-items");
            const name = document.getElementById("new-free-item-name").value.trim();
            if (!name) return;

            const itemDiv = document.createElement("div");
            itemDiv.classList.add("item");

            itemDiv.innerHTML = `
                <label>
                    <input type="checkbox" data-name="${name}" data-type="free" checked> ${name}
                </label>
                <button onclick="deleteItem(this)">Delete</button>
            `;
            container.appendChild(itemDiv);
            document.getElementById("new-free-item-name").value = "";
        }

        // Add a Free Toggle Item with a delete button
        function addFreeToggleItem() {
            const name = document.getElementById("new-free-toggle-name").value.trim();
            if (!name) return;

            const container = document.getElementById("free-toggle-items");

            const itemDiv = document.createElement("div");
            itemDiv.classList.add("item");

            itemDiv.innerHTML = `
                <label>
                    <input type="checkbox" data-name="${name}" data-type="free-toggle" checked> ${name}
                </label>
                <button onclick="deleteItem(this)">Delete</button>
            `;
            container.appendChild(itemDiv);
            document.getElementById("new-free-toggle-name").value = "";
        }

        // Add a Paid Item with a delete button
        function addPaidItem() {
            const name = document.getElementById("new-paid-item-name").value.trim();
            const price = parseFloat(document.getElementById("new-paid-item-price").value);
            if (!name || isNaN(price)) return;

            const container = document.getElementById("paid-items");

            const itemDiv = document.createElement("div");
            itemDiv.classList.add("item");

            itemDiv.innerHTML = `
                <label>
                    <input type="checkbox" data-name="${name}" data-type="paid" checked> ${name}
                </label>
                $<input type="number" value="${price}" step="0.01">
                <button onclick="deleteItem(this)">Delete</button>
            `;
            container.appendChild(itemDiv);
            document.getElementById("new-paid-item-name").value = "";
            document.getElementById("new-paid-item-price").value = "";
        }

        // Add a Paid Toggle Item with a delete button
        function addPaidToggleItem() {
            const name = document.getElementById("new-paid-toggle-name").value.trim();
            const price = parseFloat(document.getElementById("new-paid-toggle-price").value);
            if (!name || isNaN(price)) return;

            const container = document.getElementById("paid-toggle-items");

            const itemDiv = document.createElement("div");
            itemDiv.classList.add("item");

            itemDiv.innerHTML = `
                <label>
                    <input type="checkbox" data-name="${name}" data-type="paid-toggle" checked> ${name}
                </label>
                $<input type="number" value="${price}" step="0.01">
                <button onclick="deleteItem(this)">Delete</button>
            `;
            container.appendChild(itemDiv);
            document.getElementById("new-paid-toggle-name").value = "";
            document.getElementById("new-paid-toggle-price").value = "";
        }

        // Delete an item from the section
        function deleteItem(button) {
            const itemDiv = button.parentElement;
            itemDiv.remove();
        }

        // Collect the items to send to the backend
        async function addItem() {
            const params = new URLSearchParams(window.location.search);

            const updatedData = {
                itemName: document.getElementById("item-name").value,
                category: document.getElementById("category").value,
                price: parseFloat(document.getElementById("item-price").value),
                freeItems: getUpdatedItems("free-items"),
                freeToggleItems: getUpdatedToggleItems("free-toggle-items"),
                paidItems: getUpdatedItems("paid-items"),
                paidToggleItems: getUpdatedToggleItems("paid-toggle-items"),
                itemImageUrl: document.getElementById("item-image-url").value,
               
            };


            try {
                const response = await fetch("http://127.0.0.1:5000/add-item", {
                    method: "POST",
                    headers: {
                        "Content-Type": "application/json"
                    },
                    body: JSON.stringify({  
                        update_fields: updatedData
                    })
                });

                const result = await response.json();
                alert(result.message);
            } catch (error) {
                console.error("Error adding item:", error);
                //alert("Failed to add item.");
            }
        }

        // Get selected (checked) items from a container
        function getUpdatedItems(containerId) {
            const items = {};
            document.getElementById(containerId).querySelectorAll("input[type='checkbox']").forEach(input => {
                items[input.getAttribute("data-name")] = input.checked;
            });
            return items;
        }

        // Get selected toggle items from a container
        function getUpdatedToggleItems(containerId) {
            const toggleItems = [];
            document.getElementById(containerId).querySelectorAll("div").forEach(div => {
                const name = div.querySelector("input[type='checkbox']").getAttribute("data-name");
                const type = div.querySelector("input[type='checkbox']").getAttribute("data-type");
                const selected = div.querySelector("input[type='checkbox']").checked;
                const priceInput = div.querySelector("input[type='number']");
                const price = priceInput ? parseFloat(priceInput.value) : 0;

                toggleItems.push({ name, type, selected, price });
            });
            return toggleItems;
        }

        window.onload = () => {
            // Any initial setup if needed
        };
    </script>
</body>

</html>